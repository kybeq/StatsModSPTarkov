{% extends "base.html" %} {% block title %}Strona Główna - Raporty z Rajdów{%
endblock %} {% block content %}
<h1 class="mb-4 display-5">Panel Raportów</h1>
{# Użyto display dla większego nagłówka #}

<div class="row section-spacer">
  {# Dodano section-spacer #}
  <div class="col-lg-6 mb-4 mb-lg-0">
    {# Odstęp na dole na małych ekranach #}
    <h2>Ostatni rajd</h2>
    {% if latest_raid %} {# Usunięto raid-result-* z karty, dodano card-reveal
    #}
    <div class="card card-reveal h-100">
      {# h-100 dla równej wysokości w wierszu #}
      <div
        class="card-header d-flex justify-content-between align-items-center"
      >
        <span>
          {# Dodano ikonę mapy #}
          <i class="bi bi-map me-1 text-muted"></i>
          <span class="badge bg-primary me-2"
            >{{ latest_raid.location | default('Nieznana Mapa') }}</span
          >
        </span>
        <small class="text-muted"
          >{{ latest_raid.timestamp.strftime('%Y-%m-%d %H:%M') if
          latest_raid.timestamp else 'Brak daty' }}</small
        >
      </div>
      <div class="card-body">
        {# Definicja klasy wyniku dla strong tag #} {% set result_class =
        'text-status-warning' %} {# Domyślny dla Unknown/MIA itp #} {% if
        latest_raid.raid_result == 'Killed' %} {% set result_class =
        'text-status-danger' %} {% elif latest_raid.raid_result in ['Survived',
        'Runner', 'Left'] %} {% set result_class = 'text-status-success' %} {%
        endif %} {# Użycie list-key-value #}
        <ul class="list-key-value mb-3">
          <li>
            <span class="key">Gracz:</span>
            <span class="value"
              ><a
                href="{{ url_for('player_details', nickname=latest_raid.nickname) }}"
                class="player-link"
                >{{ latest_raid.nickname | default('Nieznany') }}</a
              >
              (Lvl {{ latest_raid.level | default('?') }}, {{ latest_raid.side |
              default('?') }})</span
            >
          </li>
          <li>
            <span class="key">Wynik:</span>
            <span class="value"
              ><strong class="{{ result_class }}"
                >{{ latest_raid.raid_result | default('Nieznany') }}</strong
              >
              {% if latest_raid.exit_name %}({{ latest_raid.exit_name }}){%
              endif %}</span
            >
          </li>
          <li>
            <span class="key">Czas:</span>
            <span class="value"
              >{{ latest_raid.play_time_formatted | default('N/A') }}</span
            >
          </li>
          <li>
            <span class="key">Zabójstwa:</span>
            <span class="value"
              >{{ latest_raid.kills_count | default('0') }}</span
            >
          </li>
          <li>
            <span class="key">Doświadczenie:</span>
            <span class="value"
              >{{ "{:,}".format(latest_raid.total_session_exp_calculated |
              default('0') | int).replace(",", " ") }} XP</span
            >
          </li>
        </ul>
        <a
          href="{{ url_for('raid_details', filename=latest_raid.filename) }}"
          class="btn btn-primary btn-sm"
        >
          <i class="bi bi-search me-1"></i> Zobacz szczegóły
        </a>
      </div>
    </div>
    {% else %}
    <div class="alert alert-info d-flex align-items-start" role="alert">
      <i class="alert-icon bi bi-info-circle-fill"></i>
      <div class="alert-content ms-3">
        <h4 class="alert-heading mb-1">Brak danych</h4>
        Nie znaleziono żadnych przetworzonych plików rajdów w folderze
        <code>debug_logs</code>.
      </div>
    </div>
    {% endif %}
  </div>

  <div class="col-lg-6">
    <h2>Gracze</h2>
    {% if players %} {# Użycie table-container #}
    <div class="table-container card-reveal">
      <table class="table table-striped table-hover mb-0">
        {# Usunięto table-bordered #}
        <thead>
          {# Usunięto thead-light, styl brane z CSS #}
          <tr>
            <th>Nazwa gracza</th>
            <th class="text-center">Poziom</th>
            <th class="text-center">Strona</th>
            <th class="text-center">Rajdy</th>
            <th class="text-center">Akcje</th>
          </tr>
        </thead>
        <tbody>
          {% for nickname, data in players %}
          <tr>
            <td>
              <a
                href="{{ url_for('player_details', nickname=nickname) }}"
                class="player-link"
                >{{ nickname }}</a
              >
            </td>
            <td class="text-center">{{ data.latest_level | default('?') }}</td>
            <td class="text-center">{{ data.latest_side | default('?') }}</td>
            <td class="text-center">
              <span class="badge bg-secondary rounded-pill"
                >{{ data.raid_count }}</span
              >
            </td>
            <td class="text-center">
              <a
                href="{{ url_for('player_details', nickname=nickname) }}"
                class="btn btn-outline-secondary btn-sm"
                title="Zobacz rajdy gracza"
              >
                <i class="bi bi-person-lines-fill"></i> {# Ikona dla przycisku
                #}
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {# Koniec .table-container #} {% else %}
    <p class="text-muted fst-italic">Brak danych o graczach do wyświetlenia.</p>
    {% endif %}
  </div>
</div>
{# Koniec .row #} {% endblock %}
