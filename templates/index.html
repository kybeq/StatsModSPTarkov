{% extends "base.html" %} {% block title %}StatsMod - Strona Główna{% endblock
%} {% block content %}
<section>
  <hr class="col-3 col-md-12 my-5" />
  {# Twoje oryginalne klasy #} {% if errors %}
  <div class="alert alert-danger" role="alert">
    <h4 class="alert-heading">Wystąpiły błędy podczas ładowania danych!</h4>
    <ul>
      {% for error_msg in errors %}
      <li>{{ error_msg }}</li>
      {% endfor %}
    </ul>
    <hr />
    <p class="mb-0">Sprawdź konsolę serwera po więcej informacji.</p>
  </div>
  {% endif %}

  <div class="row g-5">
    <div class="col-md-4 col-sm-12 border-end">
      <h1 class="mb-5">Ostatni rajd</h1>
      {% if latest_raid %} {# latest_raid to teraz słownik o ustalonej
      strukturze #}
      <div class="card mb-3 shadow-lg">
        <img
          src="{{ get_map_image_url(latest_raid.map_name) }}"
          {#
          Używamy
          .map_name
          #}
          class="img-fluid"
          alt="Mapa {{ latest_raid.map_name }}"
        />
        <div class="card-body">
          <h3 class="card-title">{{ latest_raid.map_name }}</h3>
          {# Używamy .map_name #}
          <p class="card-text">
            {# Zakładamy, że routes.py przekazuje 'timestamp_formatted' (już
            lokalny) #}
            <small class="text-body-secondary"
              >Data: {{ latest_raid.timestamp_formatted }}</small
            >
          </p>
        </div>
        <ul class="list-group list-group-flush">
          <li
            class="list-group-item p-3 {% if latest_raid.raid_result == get_item_name('Survived') or latest_raid.raid_result == get_item_name('Runner') %}text-success-emphasis bg-success-subtle border-success-subtle {% elif latest_raid.raid_result == get_item_name('Killed') or latest_raid.raid_result == get_item_name('MissingInAction') %}text-danger-emphasis bg-danger-subtle border-danger-subtle {% else %}text-warning-emphasis bg-warning-subtle border-warning-subtle{% endif %}"
          >
            <small>Status</small>
            <h3>{{ latest_raid.raid_result }}</h3>
          </li>
          <li
            class="list-group-item p-3 {% if latest_raid.player_side and latest_raid.player_side.lower() == 'bear' %}text-danger-emphasis bg-danger-subtle border-danger-subtle {% elif latest_raid.player_side and latest_raid.player_side.lower() == 'usec' %}text-primary-emphasis bg-primary-subtle border-primary-subtle {% else %}text-secondary-emphasis bg-secondary-subtle border-secondary-subtle{% endif %}"
          >
            <small>Gracz</small>
            <h3>
              <a
                href="{{ url_for('main_routes.player_details_route', nickname=latest_raid.player_nickname) }}"
                class="text-decoration-none {% if latest_raid.player_side and latest_raid.player_side.lower() == 'bear' %}text-danger-emphasis {% elif latest_raid.player_side and latest_raid.player_side.lower() == 'usec' %}text-primary-emphasis {% else %}text-body{% endif %}"
              >
                {{ latest_raid.player_nickname }}
              </a>
            </h3>
          </li>
          {# Zmieniono z 'play_time_formatted' na 'duration_formatted' #}
          <li class="list-group-item p-3">
            <small>Czas</small>
            <h3>{{ latest_raid.duration_formatted }}</h3>
          </li>
          <ul class="list-group list-group-horizontal">
            <li class="list-group-item col border border-0">
              <small>Total Kill</small>
              <h4>{{ latest_raid.kills }}</h4>
              {# Zmieniono z kills_total_session na kills #}
            </li>
            <li class="list-group-item col border border-top-0 border-bottom-0">
              <small>EXP</small>
              <h4>{{ format_exp(latest_raid.exp_gained) }}</h4>
              {# Zmieniono z experience_gained_session na exp_gained #}
            </li>
            <li class="list-group-item col border border-0">
              <small>Exit</small>
              <h4>
                {{ latest_raid.exit_name if latest_raid.exit_name else '---' }}
              </h4>
            </li>
          </ul>
        </ul>
      </div>
      {% else %}
      <p>Brak danych o ostatnim rajdzie.</p>
      {% endif %}
    </div>
    <div class="col-md-8 col-sm-12">
      <h1 class="mb-5">Ostatnie rajdy</h1>
      {% if recent_raids %}
      <div class="table-responsive">
        <table class="table table-striped text-center">
          {# Twoja oryginalna klasa tabeli #}
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Nick</th>
              <th scope="col">Lvl</th>
              <th scope="col">Frakcja</th>
              <th scope="col">Rajdy</th>
              <th scope="col">Exp</th>
              <th scope="col">Mapa</th>
              <th scope="col">Profil</th>
            </tr>
          </thead>
          <tbody>
            {% for raid in recent_raids %} {# raid to teraz słownik o ustalonej
            strukturze #}
            <tr>
              <th scope="row">{{ loop.index }}</th>
              <td>
                <a
                  href="{{ url_for('main_routes.player_details_route', nickname=raid.player_nickname) }}"
                  class="text-decoration-none"
                  >{{ raid.player_nickname }}</a
                >
              </td>
              <td>{{ raid.player_level }}</td>
              <td>{{ get_item_name(raid.player_side) }}</td>
              <td>{{ raid.raid_count_for_player }}</td>
              {# To jest dodawane w routes.py #}
              <td>{{ format_exp(raid.exp_gained) }}</td>
              {# Używamy .exp_gained #}
              <td>{{ raid.map_name }}</td>
              {# Używamy .map_name #}
              <td>
                <a
                  href="{{ url_for('main_routes.player_details_route', nickname=raid.player_nickname) }}"
                  class="btn btn-secondary btn-sm"
                  >zobacz</a
                >
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p>Brak zarejestrowanych rajdów do wyświetlenia.</p>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
